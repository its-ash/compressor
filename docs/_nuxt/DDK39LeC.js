const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CS_Nhlth.js","./GXuH6ugM.js"])))=>i.map(i=>d[i]);
import{e as Re,f as Ae,n as Ue,c as je,h as ze,i as Oe,o as We,_ as qe}from"./GXuH6ugM.js";import{u as Te}from"./tRHI02sM.js";const Fe={class:"min-h-[calc(100vh-48px)] bg-slate-950 text-slate-200 flex flex-col"},Ne=Re({__name:"image",setup(Ve){Te({title:"Image Tools | Local WASM",meta:[{name:"description",content:"In-browser image tools: crop, perspective crop, resize, compress, optimize. Everything stays on your device."},{name:"robots",content:"index,follow"}]});let T=null,ae=null,oe=null,G=null,f=null,X=null,l=null,F=null,p={x:0,y:0,w:1,h:1},c={tl:{x:0,y:0},tr:{x:1,y:0},br:{x:1,y:1},bl:{x:0,y:1}},u="crop",U=null,j=null,Y=null,b=null,J=null,y=null,g=null,L=null,D=null,S=null,v=null,_=null,P=null,z=null,Q=null,N=[],re={},H=null,K=null,E=null,O=null,M=null,W=0;const ye=new Set(["image/heic","image/heif","image/heic-sequence","image/heif-sequence"]),ge=/\.hei[cf]$/i,se=async()=>(G||(G=(async()=>{try{const e=await Oe(()=>import("./CS_Nhlth.js"),__vite__mapDeps([0,1]),import.meta.url);T=e.compress_image,ae=e.crop_image,oe=e.perspective_crop,e.default&&typeof e.default=="function"&&await e.default()}catch(e){throw console.error("Failed to load WASM module:",e),e}})()),G),Z=e=>{if(e<1024)return`${e} B`;const t=e/1024;return t<1024?`${t.toFixed(1)} KB`:`${(t/1024).toFixed(2)} MB`},R=e=>{if(g){if(typeof e=="number"&&Number.isFinite(e)){g.textContent=`Download (${Z(e)})`;return}if(typeof e=="string"){g.textContent=e;return}g.textContent="Download"}},d=e=>{Y&&(Y.textContent=e||"")},A=e=>Math.min(1,Math.max(0,e)),he=e=>new Promise((t,n)=>{const a=new FileReader;a.onerror=()=>n(new Error(`Failed to read ${e.name}`)),a.onload=()=>t(new Uint8Array(a.result)),a.readAsArrayBuffer(e)}),ie=e=>new Promise((t,n)=>{const a=new Blob([e]),o=URL.createObjectURL(a),s=new Image;s.onload=()=>{t({width:s.naturalWidth,height:s.naturalHeight}),URL.revokeObjectURL(o)},s.onerror=()=>{URL.revokeObjectURL(o),n(new Error("Unable to read image dimensions"))},s.src=o}),ce=e=>{if(!e)return!1;const t=(e.type||"").toLowerCase();return t&&ye.has(t)?!0:ge.test(e.name||"")},we=(e,t)=>new Promise((n,a)=>{e.toBlob(o=>{o?n(o):a(new Error("Failed to convert canvas to blob"))},t)}),le=async(e,t,n)=>{if(typeof OffscreenCanvas<"u"){const r=new OffscreenCanvas(t,n),i=r.getContext("2d");if(!i)throw new Error("Unable to initialise canvas context");i.drawImage(e,0,0,t,n),e.close?.();const h=await r.convertToBlob({type:"image/png"});return new Uint8Array(await h.arrayBuffer())}const a=document.createElement("canvas");a.width=t,a.height=n;const o=a.getContext("2d");if(!o)throw new Error("Unable to initialise canvas context");o.drawImage(e,0,0,t,n),e.close?.();const s=await we(a,"image/png");return new Uint8Array(await s.arrayBuffer())},xe=async(e,t)=>{if(typeof globalThis.ImageDecoder>"u")return null;try{const n=new globalThis.ImageDecoder({data:new Uint8Array(e),type:t}),{image:a}=await n.decode(),o=a.displayWidth||a.codedWidth,s=a.displayHeight||a.codedHeight,r=await le(a,o,s);return n.close?.(),{bytes:r,dimensions:{width:o,height:s}}}catch(n){return console.warn("ImageDecoder HEIC conversion failed",n),null}},Ee=async(e,t)=>{if(typeof createImageBitmap>"u")return null;try{const n=new Blob([e],{type:t}),a=await createImageBitmap(n);return{bytes:await le(a,a.width,a.height),dimensions:{width:a.width,height:a.height}}}catch(n){return console.warn("ImageBitmap HEIC conversion failed",n),null}},Be=async e=>{const t=(e.type||"image/heic").toLowerCase(),n=await e.arrayBuffer(),a=await xe(n,t);if(a)return{...a,note:"Converted HEIC to PNG for editing."};const o=await Ee(n,t);return o?{...o,note:"Converted HEIC to PNG for editing."}:null},Ie=async e=>{if(!e)return null;if(ce(e)){const n=await Be(e);if(!n)throw new Error("Unable to convert HEIC. Please try a different browser or format.");return n}return{bytes:await he(e)}},ee=async(e,t)=>{F&&URL.revokeObjectURL(F);const n=new Blob([e]);F=URL.createObjectURL(n),b&&(b.src=F);const a=t??await ie(e).catch(()=>null);l=a;const o=a?`${a.width}×${a.height}px`:null;J&&(J.textContent=o?`${o} • ${Z(e.length)}`:Z(e.length)),me(),R(e.length),$(),k()},Ce=e=>{e&&(p={x:0,y:0,w:1,h:1},c={tl:{x:0,y:0},tr:{x:1,y:0},br:{x:1,y:1},bl:{x:0,y:1}},$(),k())},de=async e=>{if(!e)return;const t=ce(e);d(t?"Converting HEIC...":"Loading image...");try{const n=await Ie(e);if(!n||!n.bytes)throw new Error("Unable to read image bytes");const a=n.bytes;X=a,f=a;let o=n.dimensions||null;o||(o=await ie(a)),q("crop",{silent:!0}),Ce(o),await ee(a,o),te();const s=[];n.note&&s.push(n.note),s.push("Image ready. Choose a mode, adjust, then hit Process."),d(s.join(" ")),g&&(g.disabled=!1),y&&(y.disabled=!1),L&&(L.disabled=!1)}catch(n){d(n instanceof Error?n.message:String(n))}},te=()=>{!O||!E||(O.textContent=`${E.value}%`)},pe=()=>{const e=H?.value??"png",t=Number(E?.value??80),n=Math.max(10,Math.min(100,Math.round(Number.isFinite(t)?t:80)));return{format:e,quality:n}},ue=()=>{const e=(H?.value??"")==="jpeg";K&&(K.style.display=e?"grid":"none"),E&&(E.disabled=!e),O&&(O.style.display=e?"inline":"none")},be=()=>{te(),ve()},me=()=>{W+=1,M&&(clearTimeout(M),M=null)},ve=()=>{if(!f){me(),R(null);return}const{format:e,quality:t}=pe(),n=++W;M&&clearTimeout(M),R("Download (estimating…)"),M=setTimeout(async()=>{try{if(await se(),!T)throw new Error("WASM not loaded");const a=T(f,t,e);if(W!==n)return;R(a.length)}catch(a){if(W!==n)return;console.warn("Failed to estimate compressed size",a),R(null)}finally{W===n&&(M=null)}},180)},ne=()=>{if(!_)return;if(!l||u!=="crop"){_.style.display="none",_.textContent="";return}const e=Math.max(1,Math.round(p.w*l.width)),t=Math.max(1,Math.round(p.h*l.height));_.textContent=`${e}×${t}px`,_.style.display="block"},$=()=>{if(!b||!v)return;if(!l||u!=="crop"){v.style.display="none",ne();return}const e=b.clientWidth,t=b.clientHeight;if(!e||!t){v.style.display="none",ne();return}v.style.display="block",v.style.left=`${p.x*e}px`,v.style.top=`${p.y*t}px`,v.style.width=`${p.w*e}px`,v.style.height=`${p.h*t}px`,ne()},Le=()=>{if(!v||!b)return;let e=null,t=null,n=null;const a=()=>{e=null,t=null,n=null,document.removeEventListener("pointermove",o),document.removeEventListener("pointerup",a),document.removeEventListener("pointercancel",a)},o=r=>{if(!e||!t||!l)return;const i=b.clientWidth,h=b.clientHeight;if(!i||!h)return;const x=(r.clientX-n.x)/i,B=(r.clientY-n.y)/h;let{x:m,y:w,w:I,h:C}=t;const _e=4/i,He=4/h,V=()=>{m=A(m),w=A(w),I=Math.max(_e,Math.min(1-m,I)),C=Math.max(He,Math.min(1-w,C))};switch(e){case"move":m+=x,w+=B,m=A(m),w=A(w),m=Math.min(m,1-I),w=Math.min(w,1-C);break;case"nw":m+=x,w+=B,I-=x,C-=B,V();break;case"ne":w+=B,I+=x,C-=B,V();break;case"sw":m+=x,I-=x,C+=B,V();break;case"se":I+=x,C+=B,V();break}p={x:m,y:w,w:I,h:C},$(),r.preventDefault()},s=r=>{if(!l||u!=="crop")return;const i=r.target;!i.dataset.handle&&i!==v||(e=i.dataset.handle||"move",t={...p},n={x:r.clientX,y:r.clientY},r.preventDefault(),document.addEventListener("pointermove",o),document.addEventListener("pointerup",a),document.addEventListener("pointercancel",a))};v.addEventListener("pointerdown",s)},k=()=>{if(!P||!z||!Q)return;if(!l||u!=="perspective"){P.style.display="none";return}const e=b.getBoundingClientRect(),t=e.width,n=e.height;if(!t||!n){P.style.display="none";return}P.style.display="block",P.style.width=`${t}px`,P.style.height=`${n}px`,z.setAttribute("width",`${t}`),z.setAttribute("height",`${n}`),z.setAttribute("viewBox",`0 0 ${t} ${n}`);const a={tl:{x:c.tl.x*t,y:c.tl.y*n},tr:{x:c.tr.x*t,y:c.tr.y*n},br:{x:c.br.x*t,y:c.br.y*n},bl:{x:c.bl.x*t,y:c.bl.y*n}},o=`${a.tl.x},${a.tl.y} ${a.tr.x},${a.tr.y} ${a.br.x},${a.br.y} ${a.bl.x},${a.bl.y}`;Q.setAttribute("points",o),Object.entries(re).forEach(([s,r])=>{const i=a[s];if(!r||!i)return;const h=r;h.style.left=`${i.x}px`,h.style.top=`${i.y}px`})},Pe=()=>{if(!N.length)return;let e=null,t=null;const n=r=>{t&&r&&t.releasePointerCapture?.(r.pointerId),e=null,t=null,document.removeEventListener("pointermove",o),document.removeEventListener("pointerup",n),document.removeEventListener("pointercancel",n)},a=r=>{if(!l||!e)return;const i=b.getBoundingClientRect(),h=i.width,x=i.height;if(!h||!x)return;const B=A((r.clientX-i.left)/h),m=A((r.clientY-i.top)/x);c={...c,[e]:{x:B,y:m}},k()},o=r=>{e&&a(r)},s=r=>{if(!l||u!=="perspective")return;const i=r.target.dataset.point;i&&(e=i,t=r.target,r.preventDefault(),r.target.setPointerCapture?.(r.pointerId),a(r),document.addEventListener("pointermove",o),document.addEventListener("pointerup",n),document.addEventListener("pointercancel",n))};N.forEach(r=>{r.addEventListener("pointerdown",s)})},fe=()=>{D&&(D.classList.toggle("active",u==="crop"),D.setAttribute("aria-pressed",u==="crop"?"true":"false")),S&&(S.classList.toggle("active",u==="perspective"),S.setAttribute("aria-pressed",u==="perspective"?"true":"false"))},q=(e,t={})=>{if(!e||!["crop","perspective","none"].includes(e))return;const n=u!==e;u=e,fe(),$(),k(),n&&f&&!t.silent&&d(e==="crop"?"Crop mode active. Drag the handles to adjust.":e==="perspective"?"Perspective mode active. Move the four corners.":"Overlays hidden. Select a mode to adjust again.")},Me=async()=>{if(!f){d("Add an image first.");return}y&&(y.disabled=!0),d("Preparing WebAssembly module...");try{await se();let e=f;if(u==="crop"){if(!l)throw new Error("Crop needs image dimensions");const a=Math.max(0,Math.round(p.x*l.width)),o=Math.max(0,Math.round(p.y*l.height)),s=Math.max(1,Math.round(p.w*l.width)),r=Math.max(1,Math.round(p.h*l.height));d("Cropping..."),e=ae(e,a,o,s,r)}else if(u==="perspective"){if(!l)throw new Error("Perspective crop needs image dimensions");const{width:a,height:o}=l,s=new Float32Array([c.tl.x*a,c.tl.y*o,c.tr.x*a,c.tr.y*o,c.br.x*a,c.br.y*o,c.bl.x*a,c.bl.y*o]);d("Applying perspective crop..."),e=oe(e,s,a,o)}const{format:t,quality:n}=pe();d("Compressing..."),e=T(e,n,t),f=e,await ee(e),q("none",{silent:!0}),d("Done. Preview updated.")}catch(e){console.error(e),d(e instanceof Error?e.message:String(e))}finally{y&&(y.disabled=!1)}},$e=()=>{if(!f)return;const e=H?.value??"png",t=new Blob([f],{type:`image/${e}`}),n=URL.createObjectURL(t),a=document.createElement("a"),o=e==="jpeg"?"jpg":e;a.href=n,a.download=`image-tools-${Date.now()}.${o}`,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(n)},ke=async()=>{X&&(f=X,p={x:0,y:0,w:1,h:1},c={tl:{x:0,y:0},tr:{x:1,y:0},br:{x:1,y:1},bl:{x:0,y:1}},q("crop",{silent:!0}),await ee(f),d("Back to the original file."))},De=()=>{if(!j)return;const e=t=>{t.preventDefault(),t.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(t=>{j.addEventListener(t,e,!1),document.body.addEventListener(t,e,!1)}),j.addEventListener("drop",t=>{const[n]=t.dataTransfer?.files||[];n&&de(n)}),j.addEventListener("click",()=>{U&&U.click()})},Se=()=>{U=document.getElementById("fileInput"),j=document.getElementById("dropzone"),Y=document.getElementById("status"),b=document.getElementById("preview"),J=document.getElementById("meta"),y=document.getElementById("processBtn"),g=document.getElementById("downloadBtn"),L=document.getElementById("resetBtn"),D=document.getElementById("modeCrop"),S=document.getElementById("modePerspective"),v=document.getElementById("cropBox"),_=document.getElementById("cropSize"),P=document.getElementById("perspOverlay"),z=document.getElementById("perspSvg"),Q=document.getElementById("perspPolygon"),N=Array.from(document.querySelectorAll(".persp-handle")),re=N.reduce((e,t)=>{const n=t.getAttribute("data-point");return n&&(e[n]=t),e},{}),H=document.getElementById("formatSelect"),K=document.getElementById("qualityRow"),E=document.getElementById("qualityInput"),O=document.getElementById("qualityValue"),U&&U.addEventListener("change",e=>{const[t]=e.target.files||[];t&&de(t)}),y&&y.addEventListener("click",Me),g&&g.addEventListener("click",$e),L&&L.addEventListener("click",ke),D&&D.addEventListener("click",e=>{e.preventDefault(),q("crop")}),S&&S.addEventListener("click",e=>{e.preventDefault(),q("perspective")}),E&&(E.addEventListener("input",be),E.addEventListener("change",be)),H&&H.addEventListener("change",()=>{ue(),ve()}),De(),d("Drop an image or browse to get started."),y&&(y.disabled=!0),g&&(g.disabled=!0),L&&(L.disabled=!0),R(null),fe(),te(),ue(),$(),k(),Le(),Pe(),window.addEventListener("resize",()=>{$(),k()}),b&&b.addEventListener("load",()=>{requestAnimationFrame(()=>{$(),k()})})};return Ae(async()=>{await Ue(),Se()}),(e,t)=>(We(),je("div",Fe,[...t[0]||(t[0]=[ze('<section class="flex-1 p-6 overflow-y-auto" data-v-e5cbbcc7><div class="max-w-7xl mx-auto" data-v-e5cbbcc7><div class="grid grid-cols-1 lg:grid-cols-2 gap-6" data-v-e5cbbcc7><div class="lg:order-1" data-v-e5cbbcc7><div class="bg-slate-900/80 border border-white/8 rounded-xl p-6 backdrop-blur-md h-full" data-v-e5cbbcc7><div class="preview-stage mb-4 border border-white/10 rounded-lg overflow-hidden bg-black/40" id="previewStage" data-v-e5cbbcc7><img id="preview" alt="Preview" class="w-full h-auto" src="data:image/svg+xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 1280 720&#39;%3E%3Crect width=&#39;1280&#39; height=&#39;720&#39; fill=&#39;%231e293b&#39;/%3E%3Ctext x=&#39;640&#39; y=&#39;360&#39; text-anchor=&#39;middle&#39; fill=&#39;%2338bdf8&#39; font-size=&#39;48&#39; font-family=&#39;monospace&#39;%3EDrop or browse an image%3C/text%3E%3C/svg%3E" data-v-e5cbbcc7><div id="cropBox" class="crop-box" data-v-e5cbbcc7><div id="cropSize" class="crop-size" aria-live="polite" data-v-e5cbbcc7></div><span class="handle nw" data-handle="nw" data-v-e5cbbcc7></span><span class="handle ne" data-handle="ne" data-v-e5cbbcc7></span><span class="handle sw" data-handle="sw" data-v-e5cbbcc7></span><span class="handle se" data-handle="se" data-v-e5cbbcc7></span></div><div id="perspOverlay" class="persp-overlay" data-v-e5cbbcc7><svg id="perspSvg" class="persp-svg" xmlns="http://www.w3.org/2000/svg" data-v-e5cbbcc7><polygon id="perspPolygon" class="persp-polygon" data-v-e5cbbcc7></polygon></svg><span class="persp-handle" data-point="tl" data-v-e5cbbcc7></span><span class="persp-handle" data-point="tr" data-v-e5cbbcc7></span><span class="persp-handle" data-point="br" data-v-e5cbbcc7></span><span class="persp-handle" data-point="bl" data-v-e5cbbcc7></span></div></div><div class="text-slate-400 text-sm mb-3" data-v-e5cbbcc7>Use the crop box or adjust the four perspective points to refine the selection.</div><div id="meta" class="font-mono text-xs text-slate-500" data-v-e5cbbcc7></div></div></div><div class="lg:order-2" data-v-e5cbbcc7><div class="space-y-4" data-v-e5cbbcc7><label id="dropzone" class="block border-2 border-dashed border-white/10 hover:border-cyan-500/50 rounded-xl p-6 bg-cyan-500/5 cursor-pointer transition-all hover:-translate-y-0.5" data-v-e5cbbcc7><div class="mb-3" data-v-e5cbbcc7><div class="font-semibold text-base mb-1" data-v-e5cbbcc7>Drop an image or browse</div><div class="text-slate-400 text-sm" data-v-e5cbbcc7>PNG, JPEG, WebP, HEIC. Process stays local.</div></div><span class="inline-block px-4 py-2 bg-cyan-500/20 text-cyan-300 rounded-lg text-sm font-medium hover:bg-cyan-500/30 transition-colors" data-v-e5cbbcc7>Browse</span></label><input id="fileInput" type="file" accept="image/*,.heic,.heif" class="hidden" data-v-e5cbbcc7><div class="flex gap-2" data-v-e5cbbcc7><button id="modeCrop" data-mode="crop" class="px-4 py-2 rounded-lg font-semibold text-sm active:bg-cyan-500/20 active:text-cyan-300 bg-white/5 text-slate-300 hover:bg-white/10 transition-colors active" data-v-e5cbbcc7>Crop</button><button id="modePerspective" data-mode="perspective" class="px-4 py-2 rounded-lg font-semibold text-sm bg-white/5 text-slate-300 hover:bg-white/10 transition-colors" data-v-e5cbbcc7>Perspective Crop</button></div><div class="space-y-3" data-v-e5cbbcc7><div class="flex flex-col gap-2" data-v-e5cbbcc7><button id="processBtn" class="w-full px-4 py-2.5 bg-gradient-to-r from-cyan-400 to-cyan-500 text-slate-950 rounded-lg font-bold text-sm hover:-translate-y-0.5 transition-all hover:shadow-lg" data-v-e5cbbcc7>Process</button><button id="downloadBtn" class="w-full px-4 py-2.5 bg-gradient-to-r from-cyan-400 to-cyan-500 text-slate-950 rounded-lg font-bold text-sm hover:-translate-y-0.5 transition-all hover:shadow-lg" data-v-e5cbbcc7>Download</button><button id="resetBtn" class="w-full px-4 py-2.5 border border-white/20 text-slate-300 rounded-lg font-semibold text-sm hover:bg-white/5 transition-colors" data-v-e5cbbcc7>Reset</button></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3" data-v-e5cbbcc7><div id="qualityRow" class="flex items-center gap-4" data-v-e5cbbcc7><label for="qualityInput" class="text-sm font-semibold text-slate-300 whitespace-nowrap" data-v-e5cbbcc7>Compression</label><input id="qualityInput" type="range" min="10" max="100" value="80" class="flex-1 h-2 bg-white/10 rounded-full cursor-pointer" data-v-e5cbbcc7><span id="qualityValue" class="font-mono text-xs text-slate-400 min-w-12" data-v-e5cbbcc7>80%</span></div><div class="flex items-center gap-4" data-v-e5cbbcc7><label for="formatSelect" class="text-sm font-semibold text-slate-300" data-v-e5cbbcc7>Output</label><div class="relative flex-1" data-v-e5cbbcc7><select id="formatSelect" class="w-full px-3 py-2 bg-slate-800/50 border border-white/10 rounded-lg text-slate-200 text-sm font-medium appearance-none pr-8 cursor-pointer hover:bg-slate-800 transition-colors" data-v-e5cbbcc7><option value="png" data-v-e5cbbcc7>PNG</option><option value="jpeg" data-v-e5cbbcc7>JPEG</option><option value="webp" selected data-v-e5cbbcc7>WebP</option></select><svg class="absolute right-2 top-2.5 w-5 h-5 text-slate-400 pointer-events-none" fill="currentColor" viewBox="0 0 20 20" data-v-e5cbbcc7><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" data-v-e5cbbcc7></path></svg></div></div><div id="status" class="font-mono text-xs text-slate-500 min-h-5" data-v-e5cbbcc7></div></div></div></div></div></div></div></section>',1)])]))}}),Ye=qe(Ne,[["__scopeId","data-v-e5cbbcc7"]]);export{Ye as default};
